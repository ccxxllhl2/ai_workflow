# 变量面板功能说明

## 🎯 功能概述

在工作流编辑界面中新增了一个侧边变量列表面板，可以实时显示工作流中定义的所有变量，帮助用户更好地管理和跟踪变量的使用情况。

## ✨ 主要特性

### 1. 实时变量提取
- **自动检测**: 当节点配置完成后，系统会自动提取新定义的变量
- **即时更新**: 变量列表会实时反映工作流中的变量变化
- **智能解析**: 支持从不同类型的节点中提取变量

### 2. 变量分类显示
- **按节点分组**: 变量按照定义它们的节点进行分组显示
- **类型标识**: 区分初始变量和输出变量
- **图标区分**: 不同类型的节点使用不同的图标标识

### 3. 优雅的用户界面
- **侧边面板**: 从右侧滑出的变量面板，不影响主编辑区域
- **OpenAI风格**: 采用现代化的设计语言，与整体界面风格一致
- **响应式设计**: 适配不同屏幕尺寸

## 🔧 技术实现

### 变量提取逻辑

#### 支持的节点类型

1. **开始节点 (Start Node)**
   ```typescript
   // 从initialVariables JSON中提取变量名
   {
     "initialVariables": "{\"user_name\": \"张三\", \"age\": 25}"
   }
   // 提取出: user_name, age
   ```

2. **AI智能体节点 (Agent Node)**
   ```typescript
   // 从outputVariable字段提取输出变量
   {
     "outputVariable": "agent_response"
   }
   // 提取出: agent_response
   ```

3. **其他节点类型**
   - 条件判断节点: 通常不定义新变量，只使用现有变量
   - 人工控制节点: 可能修改变量但不定义新变量
   - 结束节点: 通常不定义新变量

### 核心组件

#### 1. 变量提取器 (`variableExtractor.ts`)
```typescript
export interface Variable {
  name: string;           // 变量名
  nodeId: string;         // 定义该变量的节点ID
  nodeLabel: string;      // 节点标签
  nodeType: NodeType;     // 节点类型
  source: 'output' | 'initial';  // 变量来源
}

// 主要函数
export const extractVariablesFromNodes = (nodes: WorkflowNode[]): Variable[]
```

#### 2. 变量面板组件 (`VariablePanel.tsx`)
- 响应式侧边面板
- 变量分组显示
- 节点类型图标
- 变量来源标识

#### 3. 工作流编辑器集成
- 使用 `useMemo` 优化性能
- 实时变量列表更新
- 面板开关控制

## 🎨 界面设计

### 面板布局
```
┌─────────────────────────┐
│ 🏷️ 变量列表 (5)        │ ← 头部
├─────────────────────────┤
│ 📁 开始节点             │
│   ├─ user_name [初始]   │
│   └─ age [初始]         │
│                         │
│ 🤖 AI智能体             │
│   └─ agent_response [输出] │
│                         │
│ 🔄 条件判断             │
│   (无变量定义)          │
└─────────────────────────┘
│ 变量总数: 3             │ ← 底部统计
│ 节点数: 2               │
└─────────────────────────┘
```

### 视觉元素
- **节点图标**: 每种节点类型都有专门的SVG图标
- **变量标识**: 使用不同颜色的徽章区分变量来源
- **分组卡片**: 每个节点的变量以卡片形式分组显示

## 🚀 使用方法

### 1. 打开变量面板
在工作流编辑器的顶部工具栏中，点击"变量列表"按钮：
```
[🏷️ 变量列表 (3)]
```

### 2. 查看变量信息
- **变量名**: 以等宽字体显示，便于识别
- **来源标识**: 
  - 🟢 `初始` - 来自开始节点的初始变量
  - 🔵 `输出` - 来自其他节点的输出变量
- **节点信息**: 显示定义该变量的节点名称和类型

### 3. 实时更新
当您在节点配置面板中：
- 修改开始节点的初始变量JSON
- 更改AI智能体的输出变量名
- 保存节点配置

变量列表会立即更新，反映最新的变量状态。

## 📋 使用场景

### 1. 变量管理
- 快速查看工作流中定义了哪些变量
- 避免变量名重复或冲突
- 确保变量命名的一致性

### 2. 调试辅助
- 检查变量是否正确定义
- 验证变量的来源和类型
- 排查变量引用问题

### 3. 工作流设计
- 规划变量的传递路径
- 优化变量的使用效率
- 提高工作流的可维护性

## 🔮 未来扩展

### 计划中的功能
1. **变量引用检测**: 显示哪些节点使用了特定变量
2. **变量类型推断**: 根据初始值推断变量类型
3. **变量搜索**: 在大型工作流中快速查找变量
4. **变量重命名**: 支持全局变量重命名
5. **变量依赖图**: 可视化变量之间的依赖关系

### 技术优化
1. **性能优化**: 对大型工作流的变量提取进行优化
2. **缓存机制**: 避免重复计算变量列表
3. **增量更新**: 只更新发生变化的变量

## 🎉 总结

变量面板功能为AI工作流平台带来了更好的变量管理体验：

- ✅ **实时性**: 变量列表实时更新，始终保持最新状态
- ✅ **直观性**: 清晰的视觉设计，一目了然
- ✅ **实用性**: 解决了变量管理的实际需求
- ✅ **扩展性**: 为未来功能扩展奠定了基础

这个功能让用户能够更好地理解和管理工作流中的数据流，提高了工作流设计的效率和质量。 