# Agent节点编辑界面优化

## 功能概述

为Agent节点的编辑界面添加了变量标签功能，用户可以通过点击变量标签快速插入变量引用到提示词中。

## 新增功能

### 1. 变量标签显示
- 在提示词输入框下方显示所有可用变量
- 每个变量显示为圆角小长方形
- 不同变量使用不同的背景色（基于变量名哈希值）
- 标签上显示变量名和小圆点装饰

### 2. 一键插入功能
- 点击变量标签自动在光标位置插入 `{{变量名}}`
- 自动维护光标位置
- 支持在文本中间插入

### 3. 变量来源提示
- 鼠标悬停显示变量来源信息
- 区分"初始变量"（来自Start节点）和"输出变量"（来自Agent节点）

## 实现细节

### 文件修改

#### `frontend/src/components/NodeConfigPanel/NodeConfigPanel.tsx`
- 新增 `allNodes` 参数接收所有节点信息
- 添加 `promptTextAreaRef` 用于操作文本框
- 实现 `getVariableColor()` 函数生成变量颜色
- 实现 `insertTextAtCursor()` 函数处理文本插入
- 在Agent节点配置中显示变量标签

#### `frontend/src/components/WorkflowEditor.tsx`
- 传递 `allNodes` 参数给NodeConfigPanel

### 颜色方案
使用8种预定义颜色，基于变量名哈希值分配：
- 蓝色系：`bg-blue-100 text-blue-800 border-blue-200`
- 绿色系：`bg-green-100 text-green-800 border-green-200`
- 紫色系：`bg-purple-100 text-purple-800 border-purple-200`
- 橙色系：`bg-orange-100 text-orange-800 border-orange-200`
- 粉色系：`bg-pink-100 text-pink-800 border-pink-200`
- 靛蓝系：`bg-indigo-100 text-indigo-800 border-indigo-200`
- 青色系：`bg-teal-100 text-teal-800 border-teal-200`
- 黄色系：`bg-yellow-100 text-yellow-800 border-yellow-200`

### UI设计
```
┌─────────────────────────────────────┐
│ 输入提示词 (可选)                    │
├─────────────────────────────────────┤
│                                     │
│ [文本输入框]                        │
│                                     │
├─────────────────────────────────────┤
│ 点击变量标签插入到提示词中：          │
│ ┌─────────┐ ┌─────────┐ ┌─────────┐ │
│ │ • var1  │ │ • var2  │ │ • var3  │ │
│ └─────────┘ └─────────┘ └─────────┘ │
└─────────────────────────────────────┘
```

## 使用方法

1. **编辑Agent节点**：双击Agent节点或点击配置按钮
2. **查看可用变量**：在提示词输入框下方查看变量标签
3. **插入变量**：
   - 将光标定位到想要插入变量的位置
   - 点击对应的变量标签
   - 变量引用 `{{变量名}}` 会自动插入到光标位置
4. **查看变量信息**：鼠标悬停在标签上查看变量来源

## 示例

假设工作流中有：
- Start节点定义了变量：`requirement`（需求描述）
- 前面的Agent节点输出了：`analysis`（分析结果）

在当前Agent节点的提示词中，可以这样使用：
```
请基于{{requirement}}和{{analysis}}生成详细的实施方案
```

点击标签会自动插入变量引用，无需手动输入。

## 技术特点

- **响应式设计**：变量标签自动换行适应面板宽度
- **类型安全**：完整的TypeScript类型支持
- **性能优化**：颜色哈希计算缓存，避免重复计算
- **用户体验**：平滑的悬停效果和点击反馈
- **兼容性**：与现有的变量提取系统完全兼容

## 注意事项

- 只在Agent节点配置中显示变量标签
- 变量标签只显示当前工作流中已定义的变量
- 如果没有可用变量，不会显示变量标签区域
- 支持Start节点的初始变量和其他Agent节点的输出变量 